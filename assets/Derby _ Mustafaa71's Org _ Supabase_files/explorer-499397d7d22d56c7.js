(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6526],{50893:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/logs/explorer",function(){return s(80122)}])},17635:function(e,t,s){"use strict";var a=s(52322),i=s(47852),n=s(11170),l=s(39097),r=s.n(l),o=s(13710),c=s(14528);t.Z=e=>{let{show:t,setShowUpgradePrompt:s}=e,l=(0,c.lL)();return(0,a.jsx)(i.C,{hideFooter:!0,visible:t,closable:!0,size:"medium",header:"Log retention",onCancel:()=>s(!1),children:(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsx)(i.C.Content,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm",children:"Logs can be retained up to a duration of 3 months depending on the plan that your project is on."}),(0,a.jsxs)("div",{className:"border-control bg-surface-300 rounded border",children:[(0,a.jsxs)("div",{className:"flex items-center px-4 pt-2 pb-1",children:[(0,a.jsx)("p",{className:"text-foreground-light w-[40%] text-sm",children:"Plan"}),(0,a.jsx)("p",{className:"text-foreground-light w-[60%] text-sm",children:"Retention duration"})]}),(0,a.jsxs)("div",{className:"py-1",children:[(0,a.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,a.jsx)("p",{className:"w-[40%] text-sm",children:"Free"}),(0,a.jsx)("p",{className:"w-[60%] text-sm",children:o.fg.FREE.text})]}),(0,a.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,a.jsx)("p",{className:"w-[40%] text-sm",children:"Pro"}),(0,a.jsx)("p",{className:"w-[60%] text-sm",children:o.fg.PRO.text})]}),(0,a.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,a.jsx)("p",{className:"w-[40%] text-sm",children:"Team"}),(0,a.jsx)("p",{className:"w-[60%] text-sm",children:o.fg.TEAM.text})]}),(0,a.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,a.jsx)("p",{className:"w-[40%] text-sm",children:"Enterprise"}),(0,a.jsx)("p",{className:"w-[60%] text-sm",children:o.fg.ENTERPRISE.text})]})]})]})]})}),(0,a.jsx)(i.C.Separator,{}),(0,a.jsx)(i.C.Content,{children:(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)(n.z,{type:"default",onClick:()=>s(!1),children:"Close"}),(0,a.jsx)(n.z,{asChild:!0,size:"tiny",children:(0,a.jsx)(r(),{href:"/org/".concat(null==l?void 0:l.slug,"/billing?panel=subscriptionPlan"),children:"Upgrade"})})]})})]})})}},51303:function(e,t,s){"use strict";var a=s(52322);t.Z=e=>{let{children:t,active:s,className:i}=e;return(0,a.jsx)("div",{className:[i,"flex h-full flex-grow transition-opacity ",s?"opacity-30":"opacity-100"].join(" "),children:t})}},56302:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a={list:e=>["project",e,"replicas"],statuses:e=>["project",e,"replicas-statuses"],loadBalancers:e=>["project",e,"load-balancers"]}},92575:function(e,t,s){"use strict";s.d(t,{b:function(){return c}});var a=s(36492),i=s(31696),n=s(31779),l=s(56302),r=s(99959);async function o(e,t){let{projectRef:s}=e;if(!s)throw Error("Project ref is required");let{data:a,error:n}=await (0,i.U2)("/platform/projects/{ref}/databases",{params:{path:{ref:s}},signal:t});if(n)throw n;return a}let c=function(e){let{projectRef:t}=e,{enabled:s=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{data:c}=(0,n.ix)({ref:t});return(0,a.a)(l.Z.list(t),e=>{let{signal:s}=e;return o({projectRef:t},s)},{enabled:s&&r.Qy&&(null==c?void 0:c.is_read_replicas_enabled)&&void 0!==t,...i})}},18136:function(e,t,s){"use strict";var a=s(36492),i=s(2784),n=s(13710),l=s(92575),r=s(88354),o=s(99248),c=s(9109);t.Z=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,c.TF)();let{data:s}=(0,l.b)({projectRef:e}),d=(0,n.PJ)(n.up),[u,m]=(0,i.useState)({sql:(null==t?void 0:t.sql)||"",project:e,iso_timestamp_start:t.iso_timestamp_start?t.iso_timestamp_start:d.calcFrom(),iso_timestamp_end:t.iso_timestamp_end?t.iso_timestamp_end:d.calcTo()}),p=void 0!==e&&!!u.sql,h=(0,n.GT)(u),{data:x,error:f,isLoading:j,isRefetching:g,refetch:v}=(0,a.a)(["projects",e,"logs",h],t=>{let{signal:s}=t;return(0,r.U2)("".concat(o.T5,"/projects/").concat(e,"/analytics/endpoints/logs.all?").concat(h),{signal:s})},{enabled:p,refetchOnWindowFocus:!1}),_=f?f.message:null;return!_&&(null==x?void 0:x.error)&&(_=null==x?void 0:x.error),{params:u,isLoading:p&&j||g,logData:(0,r.d8)(x)&&x.result?x.result:[],error:_,changeQuery:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";m(t=>({...t,sql:e}))},runQuery:()=>v(),setParams:m}}},94422:function(e,t,s){"use strict";s.d(t,{_:function(){return r}});var a=s(2784),i=s(13710),n=s(93463),l=s(89823);let r=e=>{var t;let s=(0,l.l)(),{data:r}=(0,n.G)({orgSlug:null==s?void 0:s.slug}),[o,c]=(0,a.useState)(!1),d=(0,i.dP)(e,null==r?void 0:null===(t=r.plan)||void 0===t?void 0:t.id);return(0,a.useEffect)(()=>{d&&c(!0)},[e]),{showUpgradePrompt:o,setShowUpgradePrompt:c,shouldShowUpgradePrompt:d}}},80122:function(e,t,s){"use strict";s.r(t),s.d(t,{LogsExplorerPage:function(){return C}});var a=s(52322),i=s(66760),n=s(28879),l=s.n(n),r=s(5632),o=s(2784),c=s(62202),d=s(79983),u=s(47852),m=s(62277),p=s(750),h=s(11170),x=s(13710),f=s(17635),j=s(92099),g=s(64703),v=s(51303),_=s(33706),y=s(79044),N=s(93463),b=s(14528),S=s(18136),w=s(94422),q=s(99248),E=s(82667);let C=()=>{(0,x.Q9)();let e=(0,r.useRouter)(),{ref:t,q:s,ite:n,its:j}=(0,i.UO)(),C=(0,b.lL)(),[P,T]=(0,o.useState)((0,E.k$)()),[Z,L]=(0,o.useState)("select\n  cast(timestamp as datetime) as timestamp,\n  event_message, metadata \nfrom edge_logs \nlimit 5"),[z,R]=(0,o.useState)(!1),[k,O]=(0,o.useState)([]),{data:F}=(0,N.G)({orgSlug:null==C?void 0:C.slug}),{params:I,logData:U,error:$,isLoading:D,changeQuery:G,runQuery:Q,setParams:V}=(0,S.Z)(t,{iso_timestamp_start:j||void 0,iso_timestamp_end:n||void 0}),[A,M]=(0,b._)("project-content-".concat(t,"-recent-log-sql"),[]),X=e=>{M([...A,{schema_version:"1",favorite:!1,sql:"",content_id:"",...e}])},{showUpgradePrompt:W,setShowUpgradePrompt:B}=(0,w._)(I.iso_timestamp_start);(0,o.useEffect)(()=>{s&&H({mode:"custom",searchString:s})},[]),(0,o.useEffect)(()=>{let e=[],t=I.iso_timestamp_start?l()(I.iso_timestamp_start):l()(),s=I.iso_timestamp_end?l()(I.iso_timestamp_end):l()(),a=Math.abs(t.diff(s,"days"));Z&&!Z.includes("limit")&&a>x.$K&&e.push({text:"When querying large date ranges, include a LIMIT clause."}),O(e)},[Z,I.iso_timestamp_start,I.iso_timestamp_end]),(0,o.useEffect)(()=>{if(j){var e;(0,x.dP)(j,null==F?void 0:null===(e=F.plan)||void 0===e?void 0:e.id)&&B(!W)}},[j,F]);let H=t=>{L(t.searchString),G(t.searchString),T((0,E.k$)()),e.push({pathname:e.pathname,query:{...e.query,q:t.searchString}}),X({sql:t.searchString})},J=t=>{let s="string"==typeof t&&t||Z;t&&"string"==typeof t&&L(t),G(s),Q(),e.push({pathname:e.pathname,query:{...e.query,q:s}}),X({sql:s})};function K(){R(!z)}let{isLoading:Y,mutate:ee}=(0,y.T)({onError:e=>{console.error(e),R(!1),c.ZP.error("Failed to save query: ".concat(e.message))},onSuccess:e=>{R(!1),c.ZP.success('Saved "'.concat(e[0].name,'" log query'))}});return(0,a.jsxs)("div",{className:"w-full h-full mx-auto",children:[(0,a.jsxs)(d.pO,{className:"w-full h-full",direction:"vertical",autoSaveId:q.dA.LOG_EXPLORER_SPLIT_SIZE,children:[(0,a.jsxs)(d.ee,{collapsible:!0,minSize:5,children:[(0,a.jsx)(x.dL,{defaultFrom:I.iso_timestamp_start||"",defaultTo:I.iso_timestamp_end||"",onDateChange:t=>{var s;let{to:a,from:i}=t;(0,x.dP)(i,null==F?void 0:null===(s=F.plan)||void 0===s?void 0:s.id)?B(!W):(V(e=>({...e,iso_timestamp_start:i||"",iso_timestamp_end:a||""})),e.push({pathname:e.pathname,query:{...e.query,its:i||"",ite:a||""}}))},onSelectSource:e=>{L(t=>{let s=t.indexOf("from");return -1===s?"".concat(t).concat(e):"".concat(t.substring(0,s+4)," ").concat(e," ").concat(t.substring(s+5))}),T((0,E.k$)())},onClear:()=>{L(""),T((0,E.k$)()),G("")},hasEditorValue:!!Z,templates:x.xN.filter(e=>"custom"===e.mode),onSelectTemplate:H,onSave:K,isLoading:D,warnings:k}),(0,a.jsx)(_.Z,{active:D}),(0,a.jsx)(g.pq,{id:P,language:"pgsql",defaultValue:Z,onInputChange:e=>L(e||""),onInputRun:J})]}),(0,a.jsx)(d.Dp,{withHandle:!0}),(0,a.jsxs)(d.ee,{collapsible:!0,minSize:5,className:"flex flex-col flex-grow",children:[(0,a.jsx)(v.Z,{active:D,children:(0,a.jsx)(x.ol,{onRun:J,onSave:K,hasEditorValue:!!Z,params:I,data:U,error:$,projectRef:t})}),(0,a.jsx)("div",{className:"flex flex-row justify-end mt-2",children:(0,a.jsx)(f.Z,{show:W,setShowUpgradePrompt:B})})]})]}),(0,a.jsx)(u.C,{size:"medium",onCancel:()=>R(!z),header:"Save log query",visible:z,hideFooter:!0,children:(0,a.jsx)(m.Z,{initialValues:{name:"",desdcription:""},onSubmit:async(e,s)=>{let{setSubmitting:a}=s;a(!0),ee({projectRef:t,payload:{id:(0,E.k$)(),name:e.name,description:e.description||"",type:"log_sql",content:{content_id:P,sql:Z,schema_version:"1",favorite:!1},visibility:"user"}})},children:()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"py-4",children:(0,a.jsx)(u.C.Content,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(p.Z,{layout:"horizontal",label:"Name",id:"name"}),(0,a.jsx)("div",{className:"text-area-text-sm",children:(0,a.jsx)(p.Z.TextArea,{layout:"horizontal",labelOptional:"Optional",label:"Description",id:"description",rows:2})})]})})}),(0,a.jsx)("div",{className:"py-3 border-t bg-surface-100",children:(0,a.jsx)(u.C.Content,{children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsx)(h.z,{size:"tiny",type:"default",onClick:()=>R(!z),children:"Cancel"}),(0,a.jsx)(h.z,{size:"tiny",loading:Y,disabled:Y,htmlType:"submit",children:"Save"})]})})})]})})})]})};C.getLayout=e=>(0,a.jsx)(j.Uj,{children:e}),t.default=C}},function(e){e.O(0,[667,9678,8183,8421,3844,9785,7263,2745,9595,4582,5573,7932,9806,1682,3958,4018,8350,7309,9229,3832,626,7774,6541,8020,6723,3710,9774,2888,179],function(){return e(e.s=50893)}),_N_E=e.O()}]);