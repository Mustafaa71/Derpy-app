(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7704],{46261:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/auth/hooks",function(){return s(68131)}])},87062:function(e,t,s){"use strict";s.d(t,{QI:function(){return a},cK:function(){return l}});var i=s(45455),n=s.n(i);function l(e){let t=null==e?void 0:e.split(",");return n()(e)||!t||(null==t?void 0:t.length)==0?{value:[]}:{value:t.map(t=>{let s=t.trim().split(" ");return 2===s.length?{name:s[0],type:s[1]}:1===s.length?{name:s[0],type:s[0]}:void console.error("Error while trying to parse function arguments",e)}).filter(Boolean)}}function a(e){let t=[];if(e)for(var s in e)t.push({name:s,value:e[s]});return{value:t}}},95569:function(e,t,s){"use strict";s.d(t,{_:function(){return c}});var i=s(85945),n=s(48228),l=s(62202),a=s(31696),r=s(7161);async function o(e){let{projectRef:t,config:s}=e,{data:i,error:n}=await (0,a.r$)("/platform/auth/{ref}/config",{params:{path:{ref:t}},body:{...s}});if(n)throw n;return i}let c=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,i.NL)();return(0,n.D)(e=>o(e),{async onSuccess(t,s,i){let{projectRef:n}=s;await a.invalidateQueries(r.o.authConfig(n)),await (null==e?void 0:e(t,s,i))},async onError(e,s,i){void 0===t?l.ZP.error("Failed to update auth configuration: ".concat(e.message)):t(e,s,i)},...s})}},7509:function(e,t,s){"use strict";s.d(t,{R:function(){return r}});var i=s(36492),n=s(31696),l=s(3641);async function a(e,t){let{projectRef:s,connectionString:i}=e;if(!s)throw Error("projectRef is required");let l=new Headers;i&&l.set("x-connection-encrypted",i);let{data:a,error:r}=await (0,n.U2)("/platform/pg-meta/{ref}/functions",{params:{path:{ref:s}},headers:l,signal:t});if(r)throw r;return a}let r=function(e){let{projectRef:t,connectionString:s}=e,{enabled:n=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.a)(l.l.list(t),e=>{let{signal:i}=e;return a({projectRef:t,connectionString:s},i)},{enabled:n&&void 0!==t,...r})}},3641:function(e,t,s){"use strict";s.d(t,{l:function(){return i}});let i={list:e=>["projects",e,"database-functions"]}},68131:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return k}});var i=s(52322),n=s(59491),l=s(99959),a=s(2784),r=s(62202),o=s(95492),c=s(39459),d=s(62277),u=s(22854),h=s(48601),_=s(14698),f=s(33635),O=s(95569),x=s(14528),T=s(92286),E=s(11170),p=s(84447),m=s(61786),A=s(52995),S=s(90504),j=s(19869),g=s(90488),N=s(87062),I=s(27570),v=s(7509),b=e=>{let{className:t,size:s="tiny",showError:n=!0,disabled:l=!1,schema:r,selectedFunctionName:c,onSelectFunction:d}=e,{project:u}=(0,I.d2)(),[h,_]=(0,a.useState)(!1),{data:f,error:O,isLoading:x,isError:T,isSuccess:b,refetch:C}=(0,v.R)({projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString}),R=(null!=f?f:[]).filter(e=>r&&e.schema===r).filter(e=>"json"===e.return_type||"jsonb"===e.return_type).filter(e=>{let{value:t}=(0,N.cK)(e.argument_types);return 1===t.length&&("json"===t[0].type||"jsonb"===t[0].type)});return(0,i.jsxs)("div",{className:t,children:[x&&(0,i.jsx)(E.z,{type:"outline",className:"w-full [&>span]:w-full",icon:(0,i.jsx)(p.Z,{className:"animate-spin",size:12}),disabled:!!l,children:(0,i.jsx)("div",{className:"w-full flex space-x-3 py-0.5",children:(0,i.jsx)("p",{className:"text-xs text-foreground-light",children:"Loading functions..."})})}),n&&T&&(0,i.jsxs)(o.bZ,{variant:"warning",className:"!px-3 !py-3",children:[(0,i.jsx)(o.Cd,{className:"text-xs text-amber-900",children:"Failed to load functions"}),(0,i.jsxs)(o.X,{className:"text-xs mb-2",children:["Error: ",O.message]}),(0,i.jsx)(E.z,{type:"default",size:"tiny",onClick:()=>C(),children:"Reload functions"})]}),b&&(0,i.jsxs)(m.J2,{open:h,onOpenChange:_,modal:!1,children:[(0,i.jsx)(m.xo,{asChild:!0,children:(0,i.jsx)(E.z,{size:s,type:"outline",className:"w-full [&>span]:w-full ".concat("small"===s?"py-1.5":""),iconRight:(0,i.jsx)(A.Z,{className:"text-foreground-light rotate-90",strokeWidth:2,size:12}),disabled:!!l,children:(0,i.jsxs)("div",{className:"w-full flex space-x-3 py-0.5",children:[(0,i.jsx)("p",{className:"text-xs text-foreground-light",children:"function"}),(0,i.jsx)("p",{className:"text-xs",children:"*"===c?"All functions":c})]})})}),(0,i.jsx)(m.yk,{className:"p-0",side:"bottom",align:"start",children:(0,i.jsxs)(S.mY,{children:[(0,i.jsx)(S.sZ,{placeholder:"Search functions..."}),(0,i.jsxs)(S.e8,{children:[(0,i.jsx)(S.rb,{children:"No functions found"}),(0,i.jsx)(S.fu,{children:(0,i.jsxs)(j.x,{className:(R||[]).length>7?"h-[210px]":"",children:[!(R||[]).length&&(0,i.jsx)(S.di,{disabled:!0,className:"flex items-center justify-between space-x-2 w-full",children:(0,i.jsxs)("span",{children:["No function with a single JSON/B argument",(0,i.jsx)("br",{}),"and JSON/B return type found in this schema."]})},"no-function-found"),null==R?void 0:R.map(e=>(0,i.jsxs)(S.di,{value:e.name.replaceAll('"',""),className:"cursor-pointer flex items-center justify-between space-x-2 w-full",onSelect:()=>{d(e.name),_(!1)},onClick:()=>{d(e.name),_(!1)},children:[(0,i.jsx)("span",{children:e.name}),c===e.name&&(0,i.jsx)(g.Z,{className:"text-brand",strokeWidth:2})]},e.id))]})})]})]})})]})]})},C=e=>{let{id:t,values:s,descriptionText:n,setFieldValue:l,disabled:r=!1}=e,[o,c,d,u,h]=(s[t]||"").split("/"),[_,f]=(0,a.useState)(u||"public"),[O,x]=(0,a.useState)(h||"");return(0,a.useEffect)(()=>{u&&f(u)},[u]),(0,a.useEffect)(()=>{h&&x(h)},[h]),(0,i.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,i.jsx)(T.Z,{size:"tiny",showError:!1,selectedSchemaName:_,onSelectSchema:e=>{f(e),x(""),l(t,"")},disabled:!!r||!s}),(0,i.jsx)(b,{size:"tiny",schema:_,selectedFunctionName:O,onSelectFunction:e=>{x(e),l(t,"pg-functions://postgres/".concat(_,"/").concat(e))},disabled:!!r||!s}),n&&(0,i.jsx)("div",{className:"mt-2 text-foreground-lighter leading-normal text-sm",children:n})]})};let R=(0,h.object)({HOOKS_CUSTOM_ACCESS_TOKEN_ENABLED:(0,h.boolean)(),HOOKS_CUSTOM_ACCESS_TOKEN_URI:(0,h.string)()}),y="auth-basic-hooks-form";var F=()=>{let{ref:e}=(0,l.UO)(),{data:t,error:s,isLoading:h,isError:T,isSuccess:E}=(0,f.$E)({projectRef:e}),{mutate:p,isLoading:m}=(0,O._)(),A=(0,x.Xo)(n.KA.UPDATE,"custom_config_gotrue"),S={HOOK_CUSTOM_ACCESS_TOKEN_ENABLED:(null==t?void 0:t.HOOK_CUSTOM_ACCESS_TOKEN_ENABLED)||!1,HOOK_CUSTOM_ACCESS_TOKEN_URI:(null==t?void 0:t.HOOK_CUSTOM_ACCESS_TOKEN_URI)||""};return T?(0,i.jsxs)(o.bZ,{variant:"destructive",children:[(0,i.jsx)(c.Z,{strokeWidth:2}),(0,i.jsx)(o.Cd,{children:"Failed to retrieve auth configuration"}),(0,i.jsx)(o.X,{children:s.message})]}):(0,i.jsx)(d.Z,{id:y,initialValues:S,onSubmit:(t,s)=>{let{resetForm:i}=s,n={...t};""===n.HOOK_CUSTOM_ACCESS_TOKEN_URI&&(n.HOOK_CUSTOM_ACCESS_TOKEN_URI=null),p({projectRef:e,config:n},{onError:()=>r.ZP.error("Failed to update settings"),onSuccess:()=>{r.ZP.success("Successfully updated settings"),i({values:t,initialValues:t})}})},validationSchema:R,children:e=>{let{handleReset:t,resetForm:s,values:n,initialValues:l,setFieldValue:r}=e,o=JSON.stringify(n)!==JSON.stringify(l);return(0,a.useEffect)(()=>{E&&s({values:S,initialValues:S})},[E]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(_.ph,{title:"Auth Hooks (Beta)",description:"Use PostgreSQL functions to customize the behavior of Supabase Auth to meet your needs."}),(0,i.jsxs)(_.by,{disabled:!0,footer:(0,i.jsx)("div",{className:"flex py-4 px-8",children:(0,i.jsx)(_.iN,{form:y,isSubmitting:m,hasChanges:o,handleReset:t,disabled:!A,helper:A?void 0:"You need additional permissions to update authentication settings"})}),children:[(0,i.jsx)(_.hj,{header:(0,i.jsx)(_.S0,{children:"Customize Access Token (JWT) Claims"}),children:(0,i.jsxs)(_.B4,{loading:h,children:[(0,i.jsx)(C,{id:"HOOK_CUSTOM_ACCESS_TOKEN_URI",descriptionText:"Select the function to be called by Supabase Auth each time a new JWT is created. It should return the claims you wish to be present in the JWT.",values:n,setFieldValue:r,disabled:!A}),n.HOOK_CUSTOM_ACCESS_TOKEN_URI&&(0,i.jsx)(u.Z,{id:"HOOK_CUSTOM_ACCESS_TOKEN_ENABLED",size:"medium",label:"Enable hook",layout:"flex",disabled:!A})]})}),(0,i.jsx)("div",{className:"border-t border-muted"})]})]})}})},K=s(75716),M=s(93463);let P=(0,h.object)({HOOKS_MFA_VERIFICATION_ATTEMPT_ENABLED:(0,h.boolean)(),HOOKS_MFA_VERIFICATION_ATTEMPT_URI:(0,h.string)(),HOOKS_PASSWORD_VERIFICATION_ATTEMPT_ENABLED:(0,h.boolean)(),HOOKS_PASSWORD_VERIFICATION_ATTEMPT_URI:(0,h.string)()}),U="enterprise-hooks-config";var w=()=>{var e,t;let{ref:s}=(0,l.UO)(),{data:h,error:T,isLoading:E,isError:p,isSuccess:m}=(0,f.$E)({projectRef:s}),{mutate:A,isLoading:S}=(0,O._)(),j=(0,x.Xo)(n.KA.UPDATE,"custom_config_gotrue"),g=(0,x.lL)(),{data:N,isSuccess:I}=(0,M.G)({orgSlug:null==g?void 0:g.slug}),v=I&&(null==N?void 0:null===(e=N.plan)||void 0===e?void 0:e.id)!=="free"&&(null==N?void 0:null===(t=N.plan)||void 0===t?void 0:t.id)!=="pro",b={HOOK_MFA_VERIFICATION_ATTEMPT_ENABLED:(null==h?void 0:h.HOOK_MFA_VERIFICATION_ATTEMPT_ENABLED)||!1,HOOK_MFA_VERIFICATION_ATTEMPT_URI:(null==h?void 0:h.HOOK_MFA_VERIFICATION_ATTEMPT_URI)||"",HOOK_PASSWORD_VERIFICATION_ATTEMPT_ENABLED:(null==h?void 0:h.HOOK_PASSWORD_VERIFICATION_ATTEMPT_ENABLED)||!1,HOOK_PASSWORD_VERIFICATION_ATTEMPT_URI:(null==h?void 0:h.HOOK_PASSWORD_VERIFICATION_ATTEMPT_URI)||""};return p?(0,i.jsxs)(o.bZ,{variant:"destructive",children:[(0,i.jsx)(c.Z,{strokeWidth:2}),(0,i.jsx)(o.Cd,{children:"Failed to retrieve auth configuration"}),(0,i.jsx)(o.X,{children:T.message})]}):(0,i.jsx)(d.Z,{id:U,initialValues:b,onSubmit:(e,t)=>{let{resetForm:i}=t,n={...e};""===n.HOOK_MFA_VERIFICATION_ATTEMPT_URI&&(n.HOOK_MFA_VERIFICATION_ATTEMPT_URI=null),""===n.HOOK_PASSWORD_VERIFICATION_ATTEMPT_URI&&(n.HOOK_PASSWORD_VERIFICATION_ATTEMPT_URI=null),A({projectRef:s,config:n},{onError:()=>{r.ZP.error("Failed to update settings")},onSuccess:()=>{r.ZP.success("Successfully updated settings"),i({values:e,initialValues:e})}})},validationSchema:P,children:e=>{let{handleReset:t,resetForm:n,values:l,initialValues:r,setFieldValue:o}=e,c=JSON.stringify(l)!==JSON.stringify(r);return(0,a.useEffect)(()=>{m&&n({values:b,initialValues:b})},[m]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(_.ph,{title:"Enterprise Hooks",description:"Advanced Auth hooks are available to Teams and Enterprise plan customers."}),(0,i.jsxs)(_.by,{disabled:!0,footer:(0,i.jsx)("div",{className:"flex py-4 px-8",children:(0,i.jsx)(_.iN,{form:U,isSubmitting:S,hasChanges:c,handleReset:t,disabled:!j||!v,helper:j?void 0:"You need additional permissions to update authentication settings"})}),children:[!v&&void 0!==g&&(0,i.jsx)(K.Z,{primaryText:"Upgrade plan",secondaryText:"Configuring Enterprise Hooks requires a Teams or Enterprise plan.",projectRef:s,organizationSlug:g.slug,buttonText:"Upgrade"}),(0,i.jsxs)("div",{className:v?"":"opacity-50",children:[(0,i.jsx)(_.hj,{header:(0,i.jsx)(_.S0,{children:"MFA Verification Attempt"}),children:(0,i.jsxs)(_.B4,{loading:E,children:[(0,i.jsx)(C,{id:"HOOK_MFA_VERIFICATION_ATTEMPT_URI",descriptionText:"Select the function to be called by Supabase Auth each time a user tries to verify an MFA factor. Return a decision on whether to reject the attempt and future ones, or to allow the user to keep trying.",values:l,setFieldValue:o,disabled:!j||!v}),l.HOOK_MFA_VERIFICATION_ATTEMPT_URI&&(0,i.jsx)(u.Z,{id:"HOOK_MFA_VERIFICATION_ATTEMPT_ENABLED",size:"small",label:"Enable hook",layout:"flex",disabled:!j||!v})]})}),(0,i.jsx)("div",{className:"border-t border-muted"}),(0,i.jsx)(_.hj,{header:(0,i.jsx)(_.S0,{children:"Password Verification Attempt"}),children:(0,i.jsxs)(_.B4,{loading:E,children:[(0,i.jsx)(C,{id:"HOOK_PASSWORD_VERIFICATION_ATTEMPT_URI",descriptionText:"Select the function to be called by Supabase Auth each time a user tries to sign in with a password. Return a decision whether to allow the user to reject the attempt, or to allow the user to keep trying.",values:l,setFieldValue:o,disabled:!j||!v}),l.HOOK_PASSWORD_VERIFICATION_ATTEMPT_URI&&(0,i.jsx)(u.Z,{id:"HOOK_PASSWORD_VERIFICATION_ATTEMPT_ENABLED",size:"small",label:"Enable hook",layout:"flex",disabled:!j||!v})]})})]}),(0,i.jsx)("div",{className:"border-t border-muted"})]})]})}})},H=s(92099),V=s(14782);let D=()=>{let e=(0,x.Xo)(n.KA.READ,"custom_config_gotrue");return(0,x.N4)()&&!e?(0,i.jsx)(V.Z,{isFullPage:!0,resourceText:"access your project's auth hooks"}):(0,i.jsx)(_.ld,{children:(0,i.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,i.jsx)(F,{}),(0,i.jsx)(w,{})]})})};D.getLayout=e=>(0,i.jsx)(H.g1,{children:e});var k=D}},function(e){e.O(0,[667,9678,8183,8421,3844,9785,7263,2745,9595,4582,5573,7932,9806,1682,8601,7309,9229,3832,626,7774,6541,8020,6723,9774,2888,179],function(){return e(e.s=46261)}),_N_E=e.O()}]);